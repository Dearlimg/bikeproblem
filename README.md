# 共享单车租赁预测系统

## 项目简介

本项目使用机器学习方法预测共享单车的租赁数量。基于历史数据中的环境因素（天气、温度、湿度等）和季节信息，训练回归模型来预测未来的自行车租赁需求。

## 问题描述

共享单车系统的租赁数量受到多种因素影响：
- **时间因素**：季节、月份、星期、小时
- **天气因素**：温度、体感温度、湿度、风速、天气状况
- **社会因素**：是否工作日、是否节假日

通过分析这些特征与租赁数量之间的关系，我们可以建立预测模型，帮助：
- 优化车辆调度
- 预测需求高峰
- 提高运营效率

## 解决方案原理

### 1. 数据预处理

- **特征选择**：从原始数据中提取相关特征，去除无关列（如记录索引、日期等）
- **特征标准化**：使用StandardScaler对特征进行标准化，使不同量纲的特征具有可比性
- **数据划分**：将数据分为训练集（80%）和测试集（20%）

### 2. 模型选择

本项目实现了两种回归模型：

#### 线性回归 (Linear Regression)
- **原理**：假设目标变量与特征之间存在线性关系
- **公式**：`y = w₁x₁ + w₂x₂ + ... + wₙxₙ + b`
- **优点**：简单、可解释性强、训练速度快
- **缺点**：无法捕捉非线性关系

#### 随机森林回归 (Random Forest Regression)
- **原理**：集成多个决策树，通过投票或平均得到最终预测
- **优点**：
  - 能捕捉非线性关系
  - 对过拟合有较好的抗性
  - 可以评估特征重要性
- **缺点**：模型复杂度较高，可解释性相对较弱

### 3. 模型评估指标

- **MSE (均方误差)**：`MSE = (1/n) Σ(y_true - y_pred)²`
  - 衡量预测值与真实值的平均平方差
  - 对异常值敏感

- **RMSE (均方根误差)**：`RMSE = √MSE`
  - MSE的平方根，与目标变量同量纲
  - 更直观地反映预测误差

- **MAE (平均绝对误差)**：`MAE = (1/n) Σ|y_true - y_pred|`
  - 预测误差的平均绝对值
  - 对异常值不敏感

- **R² 分数 (决定系数)**：`R² = 1 - (SS_res / SS_tot)`
  - 衡量模型对数据变异的解释程度
  - 取值范围：(-∞, 1]，越接近1越好

### 4. 模型训练流程

```
原始数据
  ↓
数据加载与检查
  ↓
特征工程（选择、标准化）
  ↓
数据划分（训练集/测试集）
  ↓
模型训练（线性回归、随机森林）
  ↓
模型评估（MSE、RMSE、MAE、R²）
  ↓
结果可视化（预测图、残差图、特征重要性）
```

## 项目结构

```
bikeproblem/
├── data/                    # 数据目录
│   ├── day.csv             # 每日聚合数据
│   └── hour.csv            # 每小时聚合数据
├── src/                     # 源代码目录
│   ├── __init__.py
│   ├── data_loader.py      # 数据加载模块
│   ├── data_preprocessor.py # 数据预处理模块
│   ├── model_trainer.py    # 模型训练模块
│   └── visualizer.py       # 可视化模块
├── doc/                     # 文档目录
│   ├── 原理讲解-大白话版.md  # 原理讲解文档
│   ├── 结果分析报告.md      # 结果分析报告
│   ├── 随机森林实现原理.md  # 随机森林实现详解
│   └── 共享单车问题.docx    # 原始问题文档
├── output/                  # 输出目录（运行后生成）
│   ├── *.png               # 可视化图表
├── main.py                  # 主程序入口
├── analyze_results.py       # 结果分析脚本
├── requirements.txt         # Python依赖
├── README.md               # 本文档
└── Readme.txt              # 数据集说明文档
```

## 安装与运行

### 1. 环境要求

- Python 3.8+
- pip

### 2. 安装依赖

```bash
pip install -r requirements.txt
```

### 3. 运行程序

**主程序**（训练模型并生成可视化）：
```bash
python main.py
```

**结果分析脚本**（生成详细分析报告）：
```bash
python analyze_results.py
```

### 4. 查看结果

运行完成后，所有可视化结果将保存在 `output/` 目录中：
- `*_predictions.png`: 预测值 vs 真实值散点图
- `*_residuals.png`: 残差分析图
- `model_comparison.png`: 模型性能对比图
- `feature_importance.png`: 特征重要性图

详细的分析报告和原理讲解文档请查看 `doc/` 目录。

## 代码说明

### 模块设计

项目采用模块化设计，每个模块职责单一：

1. **data_loader.py**: 负责从CSV文件加载数据，提供数据基本信息检查
2. **data_preprocessor.py**: 负责特征工程和数据标准化
3. **model_trainer.py**: 负责模型训练、评估和比较
4. **visualizer.py**: 负责生成各种可视化图表

### 关键特性

- ✅ **工程规范**：模块化设计，代码结构清晰
- ✅ **错误处理**：包含文件检查、数据验证等
- ✅ **可扩展性**：易于添加新模型或特征
- ✅ **可视化**：自动生成评估图表
- ✅ **文档完善**：代码注释和README文档

## 预期结果

运行程序后，你将看到：

1. **数据统计信息**：数据形状、列名、缺失值等
2. **模型训练过程**：每个模型的训练和评估指标
3. **最佳模型选择**：基于R²分数自动选择最佳模型
4. **可视化图表**：预测效果、残差分析、特征重要性等

## 改进方向

1. **特征工程**：
   - 添加特征交互项
   - 时间特征编码（如周期性编码）
   - 特征选择优化

2. **模型优化**：
   - 超参数调优（GridSearchCV）
   - 尝试其他模型（XGBoost、神经网络等）
   - 模型集成

3. **数据处理**：
   - 异常值检测和处理
   - 缺失值处理策略
   - 数据增强

## 参考资料

- 数据集来源：Capital Bikeshare system, Washington D.C.
- 论文引用：Fanaee-T, Hadi, and Gama, Joao, "Event labeling combining ensemble detectors and background knowledge", Progress in Artificial Intelligence (2013)

## 许可证

本项目仅用于学习和研究目的。

